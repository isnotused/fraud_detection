# ðŸ—ï¸ ç³»ç»Ÿæž¶æž„è¯´æ˜Ž

## æ•´ä½“æž¶æž„

```
åŸºäºŽå¤§æ•°æ®çš„é‡‘èžé¢†åŸŸæ¶ˆè´¹æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿ
â”œâ”€â”€ å‰ç«¯ç•Œé¢å±‚ (Streamlit)
â”‚   â”œâ”€â”€ é¦–é¡µ (home.py)
â”‚   â”œâ”€â”€ ç”¨æˆ·æ•°æ® (users_data_app.py)
â”‚   â”œâ”€â”€ é£Žé™©åˆ†æžè¯„ä¼° (data_analyzer_app.py)
â”‚   â”œâ”€â”€ æ¨¡åž‹æ›´æ–° (model_updater_app.py)
â”‚   â””â”€â”€ ç³»ç»Ÿç®¡ç† (system_management.py)
â”‚
â”œâ”€â”€ æ•°æ®å¤„ç†å±‚
â”‚   â”œâ”€â”€ æ•°æ®ç”Ÿæˆæ¨¡å—
â”‚   â”œâ”€â”€ æ—¶é—´çª—å£åˆ†å‰²
â”‚   â””â”€â”€ ç‰¹å¾æå–
â”‚
â”œâ”€â”€ åˆ†æžè¯„ä¼°å±‚
â”‚   â”œâ”€â”€ æ—¶åºåˆ†æž
â”‚   â”œâ”€â”€ è¡Œä¸ºè¯„ä¼°
â”‚   â”œâ”€â”€ å¼‚å¸¸æ£€æµ‹
â”‚   â””â”€â”€ é£Žé™©è¯„ä¼°
â”‚
â”œâ”€â”€ æœºå™¨å­¦ä¹ å±‚
â”‚   â”œâ”€â”€ RandomForestæ¨¡åž‹
â”‚   â”œâ”€â”€ å‚æ•°è‡ªé€‚åº”æ›´æ–°
â”‚   â””â”€â”€ æŒç»­å­¦ä¹ æœºåˆ¶
â”‚
â””â”€â”€ å¯è§†åŒ–å±‚
    â”œâ”€â”€ Plotlyäº¤äº’å›¾è¡¨
    â”œâ”€â”€ NetworkXç½‘ç»œå›¾
    â””â”€â”€ æ•°æ®ç»Ÿè®¡å±•ç¤º
```

## æ•°æ®æµè½¬å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ•°æ®ç”Ÿæˆ      â”‚
â”‚  users_data_app â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ç”Ÿæˆäº¤æ˜“æ•°æ®å’Œç”¨æˆ·è¡Œä¸ºæ•°æ®
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ session_state   â”‚ â† å…¨å±€çŠ¶æ€ç®¡ç†
â”‚ â”œâ”€ transaction_data
â”‚ â”œâ”€ user_behavior_data
â”‚ â”œâ”€ segmented_data
â”‚ â””â”€ transaction_features
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ä¼ é€’æ•°æ®
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. é£Žé™©åˆ†æž      â”‚
â”‚ data_analyzer   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ è®¡ç®—é£Žé™©æŒ‡æ ‡
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ session_state   â”‚
â”‚ â”œâ”€ consistency_scores
â”‚ â”œâ”€ anomaly_features
â”‚ â”œâ”€ dynamic_risk_values
â”‚ â””â”€ fraud_labels â† æ¬ºè¯ˆæ ‡è®°ç»“æžœ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ä¼ é€’ç‰¹å¾å’Œæ ‡ç­¾
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ¨¡åž‹è®­ç»ƒ      â”‚
â”‚ model_updater   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ä¿å­˜æ¨¡åž‹
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ session_state   â”‚
â”‚ â”œâ”€ fraud_model
â”‚ â””â”€ model_history
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒç®—æ³•æµç¨‹

### 1ï¸âƒ£ ç”¨æˆ·æ•°æ®é‡‡é›†æµç¨‹

```python
# æ­¥éª¤1: ç”Ÿæˆé‡‘èžäº¤æ˜“æ•°æ®
transaction_data = generate_financial_transaction_data()
# â”œâ”€ ç”¨æˆ·ID (USER0000-USER0099)
# â”œâ”€ äº¤æ˜“æ—¶é—´ (7å¤©åŽ†å²æ•°æ®)
# â”œâ”€ äº¤æ˜“ç±»åž‹ (æ¶ˆè´¹/è½¬è´¦/æçŽ°/è¿˜æ¬¾/å……å€¼)
# â”œâ”€ äº¤æ˜“é‡‘é¢ (æ ¹æ®ç±»åž‹éšæœºç”Ÿæˆ)
# â”œâ”€ äº¤æ˜“åœ°ç‚¹ (10ä¸ªä¸»è¦åŸŽå¸‚)
# â””â”€ æ¬ºè¯ˆæ ‡è®° (1%æ¦‚çŽ‡æ ‡è®°ä¸ºæ¬ºè¯ˆ)

# æ­¥éª¤2: ç”Ÿæˆç”¨æˆ·è¡Œä¸ºæ•°æ®
user_behavior_data = generate_user_behavior_data(transaction_data)
# â”œâ”€ åŸºæœ¬ä¿¡æ¯ (å¹´é¾„/æ€§åˆ«/æ”¶å…¥/ä¿¡ç”¨åˆ†)
# â”œâ”€ è®¾å¤‡ä¹ æƒ¯ (è®¾å¤‡ç±»åž‹/ç™»å½•é¢‘çŽ‡)
# â””â”€ äº¤æ˜“ä¹ æƒ¯ (å¹³å‡é‡‘é¢/åå¥½ç±»åž‹)

# æ­¥éª¤3: æ—¶é—´çª—å£åˆ†å‰²
segmented_data, windows = segment_data_by_time_window(
    transaction_data, 
    window_size="6H"  # 6å°æ—¶çª—å£
)

# æ­¥éª¤4: æå–çª—å£ç‰¹å¾
transaction_features = extract_transaction_features(segmented_data)
# â”œâ”€ total_transactions (äº¤æ˜“æ€»æ•°)
# â”œâ”€ total_amount (æ€»é‡‘é¢)
# â”œâ”€ avg_amount (å¹³å‡é‡‘é¢)
# â”œâ”€ max_amount (æœ€å¤§é‡‘é¢)
# â”œâ”€ min_amount (æœ€å°é‡‘é¢)
# â”œâ”€ fraud_ratio (æ¬ºè¯ˆçŽ‡)
# â””â”€ åˆ†å¸ƒç»Ÿè®¡
```

### 2ï¸âƒ£ é£Žé™©åˆ†æžè¯„ä¼°æµç¨‹

```python
# æ­¥éª¤1: æž„å»ºç”¨æˆ·è¡Œä¸ºå›¾
connection_strength, user_index = build_user_behavior_graph(
    user_behavior_data, 
    transaction_data
)
# å»ºç«‹ç”¨æˆ·é—´è½¬è´¦å…³ç³»ç½‘ç»œ

# æ­¥éª¤2: ç”Ÿæˆè¡Œä¸ºç‰¹å¾åˆ†å¸ƒ
behavior_distributions = generate_behavior_feature_distribution(
    connection_strength, 
    user_index, 
    transaction_features, 
    user_behavior_data
)

# æ­¥éª¤3: è®¡ç®—æ—¶é—´åç§»
transaction_sequences = {çª—å£ID: äº¤æ˜“é‡‘é¢åºåˆ—}
time_offsets = calculate_time_offset(transaction_sequences)
# ä½¿ç”¨äº’ç›¸å…³å‡½æ•°è®¡ç®—åºåˆ—é—´æ—¶åºåç§»

# æ­¥éª¤4: è®¡ç®—è¡Œä¸ºä¸€è‡´æ€§
consistency_scores = calculate_behavior_consistency(
    transaction_distributions,
    behavior_distributions,
    time_offsets
)
# ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦è¯„ä¼°ä¸€è‡´æ€§

# æ­¥éª¤5: æ£€æµ‹å¼‚å¸¸ç‰¹å¾
anomaly_features = detect_anomaly_features(transaction_features)
# æ£€æµ‹ï¼šæ¬ºè¯ˆçŽ‡>5%, å¹³å‡é‡‘é¢>5000, æœ€å¤§é‡‘é¢>50000ç­‰

# æ­¥éª¤6: ç”ŸæˆåŠ¨æ€é£Žé™©å€¼
dynamic_risk_values, core_anomaly_dims = generate_dynamic_risk_value(
    anomaly_features,
    transaction_features,
    behavior_distributions,
    consistency_scores
)
# ç»¼åˆå¼‚å¸¸ç‰¹å¾å’Œè¡Œä¸ºå˜åŒ–è®¡ç®—é£Žé™©å€¼

# æ­¥éª¤7: ç”Ÿæˆæ¬ºè¯ˆæ ‡è®° â­æ ¸å¿ƒè¾“å‡º
fraud_labels = generate_fraud_labels(
    dynamic_risk_values,
    transaction_features,
    segmented_data
)
# è¾“å‡ºï¼šðŸ”´é«˜é£Žé™©-æ¬ºè¯ˆ / ðŸŸ¡ä¸­é£Žé™©-ç–‘ä¼¼ / ðŸŸ¢ä½Žé£Žé™©-æ­£å¸¸
```

### 3ï¸âƒ£ æ¨¡åž‹æ›´æ–°æµç¨‹

```python
# æ­¥éª¤1: å‡†å¤‡è®­ç»ƒæ•°æ®
features = []  # 8ç»´ç‰¹å¾å‘é‡
labels = []    # 0/1æ ‡ç­¾ (åŸºäºŽé£Žé™©å€¼>0.5)

for window_id in window_ids:
    feature = [
        total_transactions,
        total_amount,
        avg_amount,
        max_amount,
        min_amount,
        fraud_ratio,
        consistency_score,
        risk_value
    ]
    label = 1 if risk_value > 0.5 else 0
    
# æ­¥éª¤2: æ›´æ–°æ¨¡åž‹å‚æ•°
model.update_parameters(dynamic_risk_values)
# åŸºäºŽé£Žé™©å€¼åŠ¨æ€è°ƒæ•´ï¼š
# n_estimators *= (1 + risk_value)
# max_depth *= (1 + risk_value)

# æ­¥éª¤3: è®­ç»ƒæ¨¡åž‹
accuracy = model.train(X, y)
# RandomForestClassifier
# 70% è®­ç»ƒé›†, 30% æµ‹è¯•é›†

# æ­¥éª¤4: è®°å½•åŽ†å²
model_history.append({
    'timestamp': å½“å‰æ—¶é—´,
    'accuracy': å‡†ç¡®çŽ‡,
    'samples': æ ·æœ¬æ•°,
    'fraud_rate': æ¬ºè¯ˆçŽ‡,
    'n_estimators': å†³ç­–æ ‘æ•°,
    'max_depth': æœ€å¤§æ·±åº¦
})
```

## å…³é”®æŠ€æœ¯ç‚¹

### ðŸ” å¼‚å¸¸æ£€æµ‹ç®—æ³•

```python
# 1. å¤šç»´åº¦å¼‚å¸¸æ£€æµ‹
if fraud_ratio > 0.05: anomalies.append('fraud_ratio')
if avg_amount > 5000: anomalies.append('avg_amount')
if max_amount > 50000: anomalies.append('max_amount')
if total_transactions < 10: anomalies.append('total_transactions')

# 2. æ ¸å¿ƒå¼‚å¸¸ç»´åº¦è¯†åˆ«
core_anomaly_dims = set.intersection(*all_anomaly_features)

# 3. æ ¸å¿ƒç»´åº¦æ–¹å·®è®¡ç®—
core_variance = np.var(core_values)
```

### ðŸ“Š è¡Œä¸ºä¸€è‡´æ€§ç®—æ³•

```python
# 1. ä½™å¼¦ç›¸ä¼¼åº¦
dot_product = np.dot(trans_dist, behav_dist)
norm_trans = np.linalg.norm(trans_dist)
norm_behav = np.linalg.norm(behav_dist)
similarity = dot_product / (norm_trans * norm_behav)

# 2. ç»¼åˆåç§»å½±å“
consistency = similarity * (1 - offset_impact)
```

### âš¡ åŠ¨æ€é£Žé™©å€¼ç®—æ³•

```python
# 1. è®¡ç®—æ ¸å¿ƒæ–¹å·®
core_variance = np.var(core_anomaly_values)

# 2. è®¡ç®—è¡Œä¸ºå˜åŒ– (JSæ•£åº¦)
kl1 = sum(dist1 * log(dist1 / avg_dist))
kl2 = sum(dist2 * log(dist2 / avg_dist))
js_divergence = (kl1 + kl2) / 2

# 3. ç»¼åˆé£Žé™©å› å­
risk_factor = 0.7 * core_variance * (1 - consistency) + 0.3 * behavior_change

# 4. å½’ä¸€åŒ– + å¼‚å¸¸çŽ‡è°ƒæ•´
normalized_risk = risk_factor / max_possible_variance
final_risk = normalized_risk + anomaly_ratio * 0.5
```

### ðŸ¤– æ¨¡åž‹è‡ªé€‚åº”ç®—æ³•

```python
# å‚æ•°åŠ¨æ€è°ƒæ•´
for param, value in params.items():
    if param in ['n_estimators', 'max_depth', ...]:
        new_value = value * (1 + risk_value)
    
# å–æ‰€æœ‰çª—å£çš„å¹³å‡å€¼
final_params[param] = mean(all_window_params[param])
```

## æ•°æ®ç»“æž„è¯´æ˜Ž

### Session State å­˜å‚¨ç»“æž„

```python
st.session_state = {
    # æ•°æ®ç”Ÿæˆé˜¶æ®µ
    'user_data_generated': bool,
    'transaction_data': DataFrame,      # äº¤æ˜“æ•°æ®
    'user_behavior_data': DataFrame,    # ç”¨æˆ·è¡Œä¸ºæ•°æ®
    'segmented_data': DataFrame,        # åˆ†æ®µæ•°æ®
    'windows': List[Tuple],             # æ—¶é—´çª—å£
    'transaction_features': DataFrame,  # äº¤æ˜“ç‰¹å¾
    
    # é£Žé™©åˆ†æžé˜¶æ®µ
    'analysis_completed': bool,
    'consistency_scores': Dict,         # ä¸€è‡´æ€§åˆ†æ•°
    'anomaly_features': Dict,           # å¼‚å¸¸ç‰¹å¾
    'dynamic_risk_values': Dict,        # é£Žé™©å€¼
    'fraud_labels': DataFrame,          # â­æ¬ºè¯ˆæ ‡è®°ç»“æžœ
    
    # æ¨¡åž‹è®­ç»ƒé˜¶æ®µ
    'model_trained': bool,
    'fraud_model': FraudDetectionModel, # æ¨¡åž‹å¯¹è±¡
    'model_history': List[Dict],        # è®­ç»ƒåŽ†å²
    
    # UIçŠ¶æ€
    'index': int,                       # å½“å‰é€‰é¡¹å¡
    'analyzer_index': int,              # åˆ†æžé¡µé€‰é¡¹å¡
}
```

## å¯è§†åŒ–ç»„ä»¶

### Plotly å›¾è¡¨ç±»åž‹

1. **æŸ±çŠ¶å›¾** (Bar Chart)
   - è¡Œä¸ºä¸€è‡´æ€§æŒ‡æ ‡
   - äº¤æ˜“ç±»åž‹åˆ†å¸ƒ

2. **æŠ˜çº¿å›¾** (Line Chart)
   - é£Žé™©å€¼è¶‹åŠ¿
   - æ¨¡åž‹å‡†ç¡®çŽ‡å˜åŒ–

3. **çƒ­åŠ›å›¾** (Heatmap)
   - å¼‚å¸¸ç‰¹å¾åˆ†å¸ƒ

4. **æ•£ç‚¹å›¾** (Scatter)
   - ç½‘ç»œèŠ‚ç‚¹

5. **å¤åˆå›¾** (Multiple Traces)
   - äº¤æ˜“ç±»åž‹ + æ¬ºè¯ˆçŽ‡ï¼ˆåŒè½´å›¾ï¼‰

### NetworkX ç½‘ç»œå›¾

```python
G = nx.Graph()
G.add_node(user_id, credit_score=xxx, age=xxx)
G.add_edge(sender, recipient, weight=amount)
pos = nx.spring_layout(G, k=0.5, iterations=50)
```

## æ€§èƒ½ä¼˜åŒ–

### æ•°æ®å¤„ç†ä¼˜åŒ–
- åˆ†æ®µå¤„ç†å¤§æ•°æ®é›†
- ä½¿ç”¨ `time.sleep()` æŽ§åˆ¶UIå“åº”
- DataFrame å‘é‡åŒ–æ“ä½œ

### å†…å­˜ä¼˜åŒ–
- Session state æŒ‰éœ€åŠ è½½
- åŠæ—¶é‡Šæ”¾ä¸´æ—¶å˜é‡
- æ•°æ®ç±»åž‹ä¼˜åŒ–

### UIä¼˜åŒ–
- å®¹å™¨é«˜åº¦å›ºå®š
- å»¶è¿ŸåŠ è½½å›¾è¡¨
- ç¼“å­˜è®¡ç®—ç»“æžœ

## æ‰©å±•å»ºè®®

### åŠŸèƒ½æ‰©å±•
1. âœ¨ æ”¯æŒçœŸå®žæ•°æ®å¯¼å…¥
2. âœ¨ å¢žåŠ æ›´å¤šæœºå™¨å­¦ä¹ æ¨¡åž‹
3. âœ¨ å®žæ—¶æ•°æ®æµå¤„ç†
4. âœ¨ é¢„è­¦é€šçŸ¥åŠŸèƒ½
5. âœ¨ è¯¦ç»†æŠ¥å‘Šå¯¼å‡º

### ç®—æ³•ä¼˜åŒ–
1. ðŸ”§ æ·±åº¦å­¦ä¹ æ¨¡åž‹é›†æˆ
2. ðŸ”§ æ—¶é—´åºåˆ—é¢„æµ‹
3. ðŸ”§ å¼‚å¸¸æ¨¡å¼è‡ªåŠ¨å‘çŽ°
4. ðŸ”§ å¤šæ¨¡åž‹èžåˆ

### UIæ”¹è¿›
1. ðŸŽ¨ è‡ªå®šä¹‰ä¸»é¢˜
2. ðŸŽ¨ æ›´å¤šå›¾è¡¨ç±»åž‹
3. ðŸŽ¨ ç§»åŠ¨ç«¯é€‚é…
4. ðŸŽ¨ å›½é™…åŒ–æ”¯æŒ

---

**æŠ€æœ¯æž¶æž„ç‰ˆæœ¬**: v1.0.0  
**æœ€åŽæ›´æ–°**: 2025-11-11
